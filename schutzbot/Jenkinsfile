pipeline {
    agent none

    environment {
        AWS_REGION = "us-east-2"
        AWS_BUCKET = "imagebuilder-jenkins-testing-use2"
    }

    options {
        timestamps()
        ansiColor('xterm')
        // Cancel the pipeline if it runs for more than three hours.
        timeout(
            time: 3,
            unit: "HOURS"
        )
    }
    stages {

        stage("Prepare ðŸ¤”") {
            agent { label "schutzbot" }
            steps {
                sh (
                    label: "Get environment variables",
                    script: "env | sort"
                )
            }
        }

        stage("Beaker test ðŸ¤–") {
            agent { label "beaker-runner" }
            environment {
                BEAKER_KEYTAB = credentials('osbuild-automation-keytab')
            }
            steps {
                sh "schutzbot/run_beaker_tests.sh"
            }
        }

    }

}
